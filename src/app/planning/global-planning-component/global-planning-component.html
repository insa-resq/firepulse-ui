<app-tablet>
  <div class="planning-container">
    <div class="planning-header">
      <button (click)="previous.emit()">◀ Semaine précédente</button>
      <h2>Semaine {{ nbWeek }}</h2>
      <button (click)="next.emit()">Semaine suivante ▶</button>
    </div>

    <table class="planning-table">
      <thead>
        <tr>
          <th>Pompier</th>

          @for (day of days; track day) {
            <th>{{ day | DayPipe }}</th>
          }
        </tr>
      </thead>

      <tbody>
        @for (firefighter of firefighters; track firefighter.name) {
          <tr>
            <td class="firefighter">{{ firefighter.name }}</td>

            @for (day of days; track day) {
              <td class="cell" [ngClass]="getAvailibility(firefighter.id, day)"></td>
            }
          </tr>
        }
      </tbody>
    </table>

    <div class="legende">
      <div class="legende-item"><span class="color-box AVAILABLE"></span> Disponible</div>
      <div class="legende-item"><span class="color-box ON_SHIFT"></span> Astreinte</div>
      <div class="legende-item"><span class="color-box OFF_DUTY"></span> Indisponible</div>
      <button (click)="generatePlanning()">
        @if (isLoadingGenerate) {
            <span class="spinner">⌛</span>
            Génération en cours...
        } @else {
          Générer le planning
        }
      </button>
    </div>

    <div class="inventory-card">
      <h3>Inventaire des véhicules</h3>

      <table class="inventory-table">
        <thead>
          <tr>
            <th>Véhicule</th>
            <th>Disponibilité</th>
          </tr>
        </thead>

        <tbody>
          @for (item of inventory | async; track item.vehicleId) {
            <tr>
              <td class="vehicle-type">
                {{ item.type | vehicleTypeLabel }}
              </td>
              <td>
                <span class="count">
                  {{ item.availableCount }} / {{ item.totalCount }}
                  ({{item.bookedCount }} reservé{{ item.bookedCount > 1 ? "s" : "" }})
                </span>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</app-tablet>
